FROM ubuntu:14.04.2
RUN mkdir -p /var/lib/tomcat8
RUN chmod 777 /var/lib/tomcat8
RUN mkdir -p /usr/local/share/media/{thumbs,photo,uploads} /usr/local/share/ogg/
RUN chmod -R 777 /usr/local/share/
RUN useradd khall -u 1024 -m -d /home/khall
RUN apt-get update
RUN apt-get -y upgrade
RUN apt-get -y install software-properties-common python-software-properties
RUN add-apt-repository ppa:openjdk-r/ppa
RUN apt-get update
RUN apt-get -y install openjdk-8-jdk
RUN apt-get -y install mysql-server wget git maven unzip
RUN wget -c 'http://mirror.sdunix.com/apache/tomcat/tomcat-8/v8.0.21/bin/apache-tomcat-8.0.21.tar.gz' -O /var/lib/tomcat8/apache-tomcat.tgz
RUN tar zxvf /var/lib/tomcat8/apache-tomcat.tgz -C /var/lib/tomcat8 --strip-components=1
EXPOSE 8080
ADD deploy.sh /usr/local/bin/deploy.sh
RUN chmod 777 /usr/local/bin/deploy.sh
ADD build.sh /usr/local/bin/build.sh
RUN chmod 777 /usr/local/bin/build.sh
ADD inputrc /home/khall/.inputrc
ADD bashrc /home/khall/.bashrc
RUN wget -c 'https://jvorbiscomment.googlecode.com/files/jvorbiscomment-1.0.3.zip' -O /tmp/jvorbiscomment-1.0.3.zip
RUN unzip -d /tmp -j /tmp/jvorbiscomment-1.0.3.zip jvorbiscomment-1.0.3/jvorbiscomment-1.0.3.jar
RUN sudo -u khall mvn install:install-file -Dfile=/tmp/jvorbiscomment-1.0.3.jar -DgroupId=adamb.vorbis -DartifactId=jvorbis -Dversion=1.0.3 -Dpackaging=jar
RUN su -l khall -c /usr/local/bin/build.sh
CMD /usr/local/bin/deploy.sh && bash -o vi
